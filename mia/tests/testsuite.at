AT_INIT

# define macros to skip a test if the tools were not found by configure
m4_define(AT_CHECK_WENDY, [AT_CHECK([if test "WENDY" == "not found"; then exit 77; fi])])
m4_define(AT_CHECK_LOLA, [AT_CHECK([if test "LOLA" == "not found"; then exit 77; fi])])

############################################################################
AT_BANNER([Standard Options])
############################################################################

AT_SETUP([Help output])
AT_CHECK([MIA --help],0,ignore)
AT_KEYWORDS(basic)
AT_CLEANUP

AT_SETUP([Version output])
AT_CHECK([MIA --version],0,ignore)
AT_KEYWORDS(basic)
AT_CLEANUP

############################################################################
AT_BANNER([Examples])
############################################################################

AT_SETUP([Small example (1 -> 2)])
AT_CHECK_WENDY
AT_CHECK_LOLA
AT_CHECK([cp TESTFILES/ex1.owfn TESTFILES/ex2.owfn .])
AT_CHECK([MIA ex1.owfn ex2.owfn],0,stdout,ignore)
AT_CHECK([cat stdout | wc -l],0,[3
],ignore)
AT_CLEANUP

AT_SETUP([Small example (2 -> 1)])
AT_CHECK_WENDY
AT_CHECK_LOLA
AT_CHECK([cp TESTFILES/ex1.owfn TESTFILES/ex2.owfn .])
AT_CHECK([MIA ex2.owfn ex1.owfn],0,stdout,ignore)
AT_CHECK([cat stdout | wc -l],0,[3
],ignore)
AT_CLEANUP

AT_SETUP([Registration office service (old -> new)])
AT_CHECK_WENDY
AT_CHECK_LOLA
AT_CHECK([cp TESTFILES/reg_old.owfn TESTFILES/reg_new.owfn .])
AT_CHECK([MIA reg_old.owfn reg_new.owfn],0,stdout,ignore)
AT_CHECK([cat stdout | wc -l],0,[9
],ignore)
AT_CLEANUP

AT_SETUP([Sequence 5 (original -> public view)])
AT_CHECK_WENDY
AT_CHECK_LOLA
AT_CHECK([cp TESTFILES/sequence5.owfn TESTFILES/sequence5-pv.owfn .])
AT_CHECK([MIA sequence5.owfn sequence5-pv.owfn],0,stdout,ignore)
AT_CHECK([cat stdout | wc -l],0,[12
],ignore)
AT_CLEANUP

AT_SETUP([Sequence 5 (public view -> original)])
AT_CHECK_WENDY
AT_CHECK_LOLA
AT_CHECK([cp TESTFILES/sequence5.owfn TESTFILES/sequence5-pv.owfn .])
AT_CHECK([MIA sequence5-pv.owfn sequence5.owfn],0,stdout,ignore)
AT_CHECK([cat stdout | wc -l],0,[12
],ignore)
AT_CLEANUP

AT_SETUP([Purchase Order (original -> public view)])
AT_CHECK_WENDY
AT_CHECK_LOLA
AT_CHECK([cp TESTFILES/PO.owfn TESTFILES/PO-pv.owfn .])
AT_CHECK([MIA PO.owfn PO-pv.owfn],0,stdout,ignore)
AT_CHECK([cat stdout | wc -l],0,[429
],ignore)
AT_CLEANUP

AT_SETUP([Purchase Order (public view -> original)])
AT_CHECK_WENDY
AT_CHECK_LOLA
AT_CHECK([cp TESTFILES/PO.owfn TESTFILES/PO-pv.owfn .])
AT_CHECK([MIA PO-pv.owfn PO.owfn],0,stdout,ignore)
AT_CHECK([cat stdout | wc -l],0,[429
],ignore)
AT_CLEANUP
