<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Service Technology - live</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 40px; /* 60px to make the container go all the way to the bottom of the topbar */
        padding-bottom: 20px; /* 60px to make the container go all the way to the bottom of the topbar */
        background-color: #ddd;
      }
      /* a class for the boxes */
      .stBox {
        border: 2px solid rgb(153, 153, 153);
        margin:25px 0px;
        padding:25px;
        border-radius: 8px 8px 8px 8px; 
        background-color: #fff;
      }
      .stBox .stBox {
        border: 2px solid rgb(221, 221, 221);
      }
      .toolname {
        color: rgb(0, 136, 204);
      }
      .fileHideSafari {
        visibility:hidden;
	width:0px;
        height:0px;
	margin:0px;
        padding:0px;
        position:absolute;
        left:-200px;
        top:-200px;
      }
    </style>
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="bootstrap/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="bootstrap/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="bootstrap/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="bootstrap/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="bootstrap/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top" style="display:none;">
    <div class="navbar-inner">
    <ul class="nav">
    <li>&nbsp;&nbsp;&nbsp;</li>
    <li><a href="index.html?anica">anica</a></li> 
    <li><a href="index.html?bpel2owfn">bpel2owfn</a></li>
    <li><a href="index.html?candy"  >candy</a></li>
    <li><a href="index.html?cosme">cosme</a></li>
    <li><a href="index.html?diane">diane</a></li>
    <li><a href="index.html?linda">linda</a></li>
    <li><a href="index.html?locretia">locretia</a></li>
    <li><a href="index.html?lola">lola</a></li>
    <li><a href="index.html?marlene">marlene</a></li>
    <li><a href="index.html?mia">mia</a></li>
    <li><a href="index.html?rachel">rachel</a></li>
    <li><a href="index.html?safira">safira</a></li>
    <li><a href="index.html?sara" >sara</a></li>
    <li><a href="index.html?tara">tara</a></li>
    <li><a href="index.html?wendy">wendy</a></li>
    <li><a href="index.html?yasmina">yasmina</a></li>
    </ul>
    </div>
    </div>

<!-- alert modal dialog -->
    <div id="myAlert" class="modal hide fade" role="dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3></h3>
        </div>
        <div class="modal-body">
            <p></p>
        </div>
        <div class="modal-footer">
            <a href="#" data-dismiss="modal" class="btn">Close</a>
        </div>
    </div>

    <div class="container">
    <h1 style="text-transform:uppercase;">service-technology.org/live/<span class="toolname"></span><br><small>solutions that make services behave well</small></h1>


      <div class="row">
        <span class="span12" id="alertContainer"></span>
        <div class="span6">
          <!-- GUI -->
          <div class="stBox">
            <h3>Graphical Edit</h3>
             <span id="form_container">
              loading ... </span>
          </div>
        </div>

        <div id="command-container" class="span6">
          <div class="stBox">
            <h3>
                 Textual Edit
            </h3>
            <div id="json-output-container">
            <form>
                <span class="input-append">
                    <input id="json_typeahead" type="text" class="input-xlarge" data-provide="typeahead" autocomplete="off" />
                    <button type="submit" class="btn">Add Param</button>
                </span>&nbsp;
                <span class="dropdown">
                    <p class="btn dropdown-toggle" 
                        onclick="FILE_EXPLORER.select_dropdown.call(this,function(v){var e=$('#json_typeahead');e.val(e.val()+v);});"
                        data-toggle="dropdown">
                      <i class="icon-folder-open"></i> Files...
                    </p>
            </form>
	    <form action="http://turgon.informatik.hu-berlin.de" enctype="multipart/form-data" id="outForm" method="POST">
<div class="control-group">
                <textarea name="data" class="controls input-block-level monospace" style="font-family:monospace;" id="json-output" rows="20">...</textarea>
</div>
            </form>
            </div>
          </div>
        </div>
      </div> <!-- "row" -->

      <!-- menu -->
      <div class="row" style="text-align:center;">
          <span class="btn btn-large btn-info disabled" id="undo"><i class="icon-circle-arrow-left"></i> Undo</span>
          <span class="btn btn-large btn-info disabled" id="redo"><i class="icon-circle-arrow-right"></i> Redo</span>
          <span class="btn btn-large disabled" id="undoRun"><i class="icon-fast-backward"></i> reset to previous running setup</span>
          <span class="btn btn-large disabled" id="redoRun"><i class="icon-fast-forward"></i> reset to next running setup</span>
          <span class="btn btn-large btn-primary submitButton">Submit <i class="icon-play icon-white"></i></span>
      </div>

<!-- file explorer -->
    <div id="fileExplorer_container" class="modal hide fade" role="dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>service technology</h3>
        </div>
        <div class="modal-body">
        </div>
    </div>
<!-- output modal -->
    <div id="output_container" class="modal hide fade" role="dialog" style="width:700px;" >
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>service technology</h3>
        </div>
        <div class="modal-body">

        <div id="output_loading_info">
            waiting for server response..
        </div>
        <div id="output_contents">
          <h2>Infos</h2>
          <div id="info"></div>
          <h2>stdout</h2>
          <pre id="stdout"></pre>
          <h2>stderr</h2>
          <pre id="stderr"></pre>
          <div id="files_output_container"></div>
         </div>
        </div>
        <div class="modal-footer">
            <a href="#" data-dismiss="modal" class="btn">Close</a>
        </div>
    </div>
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- extern libraries -->
    <script src="bootstrap/js/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>

<script src="fileExplorer.js"></script>
<script src="inputs.js"></script>
<script src="inputList.js"></script>
<script src="jquery.base64.min.js"></script>
<script src="formatOutput.js"></script>
<script src="peg-0.7.0.min.js"></script>
<script src="ggoConversion.js"></script>
<script src="jsonEdit.js"></script>
<script src="history.js"></script>
<script type="text/javascript">
// thank you chrome+safari#
$.fn.prettyVal = function() {
	var v = this.val();
	if(typeof v != 'string') return '';
	return this.val().replace(/^.*[\\\/]/g,'');
};



// read the input hash
// put to global scope
var search = window.location.search;
var call = search.replace(/init=([^\&]*)/gi, '');
call = decodeURIComponent(call.replace(/^\?/, ''));
var init = decodeURIComponent(RegExp.$1);
// no XSS:
tool = call.replace(/^([a-z0-9_\-]+)($|[^a-z0-9_\-].*$)/gi,'$1');
call = call.substring(tool.length, call.length);

//replace placeholders of toolname
$("span.toolname").text(tool);

// and now build the form, will be callback function for ggo-parser
buildForm = function(inputs) {

    // update typeahead with file names, when they change
    FILE_EXPLORER.onchange(JSON_BOX.changeFilenames);

    //create graphical inputsetmanager
    im = new INPUTS.InputSetManager();
    im.SetInputs(inputs);
    var b = $('#form_container').hide().empty();
    im.Create(b.get(0));
    // when things change, forward to json
    im.onChange(JSON_BOX.updateValues($('#json-output'), tool));
    im.onChange(FILE_EXPLORER.validateInputs(im.inputs));
    b.fadeIn();

    //move file inputs
    $('form#outForm').append(b.find('input[type=file]'));
    // $('form#outForm').find('input[type=file]').fadeIn();

    // create typeahead for json box
    JSON_BOX.createTypeahead($('#json_typeahead'), inputs);
    // TODO: using a closure here is not the best way...
    // TODO: maybe this can cause memory leak or bad performance?
    JSON_BOX.watchJsonBox($('#json-output'), function(p){im.update(p);} );
    // when things change in json,  forward to GUI

    // when json changes, check file for validity
    JSON_BOX.watchJsonBox($('#json-output'), FILE_EXPLORER.validateInputs(im.inputs));

    var initS = '';
    if(init) {
        try {
            var initO = JSON.parse(init);
            initS = JSON.stringify(initO, null, 4);
        } catch(e) {
            $('#myAlert h3').text('Error');
            $('#myAlert p').text('Could not parse the initial state: \n' + e);
            $('#myAlert').modal();
        }
    } else if(call.trim() != tool.trim()) {
        var ps = call.trim().split(" -");
        var psLength = ps.length;
        for(var i = 1; i < psLength; ++i) {
            ps[i] = '-' + ps[i];
        }
        var callO = {
            tool: tool,
            parameters: ps
        };
        initS = JSON.stringify(callO, null, 4);
    }

    if(initS) {
        $('#json-output').val(initS).change();
    }

    // undo-redo history
    var setState = function(s){$('#json-output').val(s).change()};
    var getState = function(){return $('#json-output').val()};
    jsonHistory = new HISTORY(getState, setState, $('#undo'), $('#redo'));
    jsonHistory.onchange( );
    JSON_BOX.watchJsonBox($('#json-output'), function(){jsonHistory.addState.call(jsonHistory);});
    im.onChange( function(){jsonHistory.addState.call(jsonHistory);});


    // successful setups history
    // TODO: GET THIS WORKING
    //var sucHist = new HISTORY(getState, setState, $('#undoRun'), $('#redoRun'));
    var sucHist = new HISTORY(getState, setState, $(), $());

    //prepare for output formatting and submit-to-server
    SERVER_CONNECT(sucHist);
};

// PARSE FROM GGO
GGO_CONVERSION.initParse(tool, buildForm);

// redirect the submit to the correct formular
$('.submitButton').click(function(){
    $('form#outForm').submit();
});

</script>
  </body>
</html>

